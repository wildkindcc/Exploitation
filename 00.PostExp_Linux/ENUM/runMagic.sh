#!/bin/bash
# Script to run my post exploitation scripts and throw them into a directory.

user=$(whoami)
hostname=$(hostname)
outputDir="ENUMOutput_$hostname"

echo -e "\n\e[00;31m#########################################################\e[00m" 
echo -e "\e[00;31m#\e[00m" "\e[00;33mRunning the local privesc findy bois\e[00m" "\e[00;31m#\e[00m" 
echo -e "\e[00;31m#########################################################\e[00m" 
echo "This script presumes that you are in a direcotry with write permissons, such as /tmp.  Current PWD: [$PWD]" 
echo "The directory $outputDir/ will be created."
echo ""

if [ -n "$ftpServer" ]; then
	echo "Will automatically upload output to FTP server @ [$ftpServer]"
fi

while true; do
    read -p "Do you wish to continue? (Y/N)" yn
    case $yn in
        [Yy]* ) break;;
        [Nn]* ) exit;;
        * ) echo "Please answer yes or no.";;
    esac
done

if [ ! -d $outputDir ]; then
  mkdir $outputDir;
fi

./LinEnum.sh -t | tee $outputDir/"$hostname"_LinEnum.txt
./unix-privesc-check detailed | tee $outputDir/"$hostname"_unix-privesc-check.txt
python linuxprivchecker.py | tee $outputDir/"$hostname"_linuxprivchecker.txt
perl Linux_Exploit_Suggester.pl | tee $outputDir/"$hostname"_Linux_Exploit_Suggester.txt

echo -e "\e[00;31m#########################################################\e[00m" 
echo -e "\e[00;31m#\e[00m" "\e[00;33mRunning directory enumeration\e[00m" "\e[00;31m#\e[00m" 
echo ""
echo -e "\e[00;31m#\e[00m" "\e[00;33mSearching for all files the current user can access and sorting by last edited date.\e[00m" "\e[00;31m#\e[00m" 
if [ -z $user ]; then
	find / -type f -printf "%TY-%Tm-%Td %TH:%TM\t%p\n" 2>/dev/null | sort -k1r > $outputDir/"$hostname"_allFiles.txt
else
	find / -type f -printf "%TY-%Tm-%Td %TH:%TM\t%p\n" 2>/dev/null | sort -k1r > $outputDir/"$hostname"_allFiles_$user.txt
fi
echo ""
echo -e "\e[00;31m#########################################################\e[00m" 
echo -e "\e[00;31m#\e[00m" "\e[00;33mChecking if Debian or Redhat and saving [packages.out]\e[00m" "\e[00;31m#\e[00m" 
/usr/bin/rpm -q -f /usr/bin/rpm >/dev/null 2>&1

if  [ $? -eq 0 ]; then
  echo -e "\e[00;31m#\e[00m" "\e[00;33mRPM List Saved!\e[00m" "\e[00;31m#\e[00m"
  rpm -qa > $outputDir/"$hostname"packages.out
else
  echo -e "\e[00;31m#\e[00m" "\e[00;33mDPKG List Saved!\e[00m" "\e[00;31m#\e[00m"
  dpkg -l > $outputDir/"$hostname"packages.out
fi

echo -e "\e[00;31m#\e[00m" "\e[00;33mDone!\e[00m" "\e[00;31m#\e[00m" 
echo ""
